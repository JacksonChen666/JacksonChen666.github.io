<!DOCTYPE html>
<!-- 
TODO:
Allow switching from files to files (have to figure out the loadLocal params first)
Multi-file editing with HTML, CSS, and JS, all saved seprately, and is usable after saving somehow, with labels
-->
<html>

<head>
	<title id="webpage-title">Live HTML Editor</title>
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<link rel="icon" href="data:image/png;base64,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">
	<link href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap" rel="stylesheet">
	<style>
		:root {--body-color:#222;--editor-bg:#333;--editor-text:#fff;--border-color:#444;--viewer-bg:#333;--viewer-text:#fff;--btn-color:#555}
		[theme=dark]{--body-color:#222;--editor-bg:#333;--editor-text:#fff;--border-color:#444;--viewer-bg:#333;--viewer-text:#fff;--btn-color:#555}
		[theme=light]{--body-color:#bdc3c7;--editor-bg:#fff;--editor-text:#000;--border-color:#ddd;--viewer-bg:#fff;--viewer-text:#000;--btn-color:#999}
		body {overflow:hidden;font-family:Arial,sans-serif;margin:0;overflow:hidden;background-color:var(--body-color);color:var(--editor-text)}
		button {background-color:#fff;color:#000}
		.main {width:100%;height:92vh;margin-bottom:0;display:inline-flex;flex-direction:row}
		.main * {border-radius:2px;min-width:100px;min-height:250px;margin:10px;width:100%;height:100%;border:1px solid var(--border-color);outline:0}
		.editor {overflow:auto;white-space:nowrap;background-color:var(--editor-bg);color:var(--editor-text);padding:5px 5px 0 5px;font-size:18px;font-family:Inconsolata,monospace;resize:none}
		#viewer {height:100.66%;width:101.4%;background-color:var(--viewer-bg);color:var(--viewer-text)}
		@media all and (max-width:768px) {.main{float:top;flex-direction:column;width:95vw}}
		noscript {font-size:300px}
		#buttons {text-align:center}
		.medium {font-size:16px}
		.small {font-size:12px}
		.mini {font-size:8px}
		.no-margin {margin:0}
		.mini-margin {margin:5px}
		.no-padding {padding:0}
		.middle {text-align:center}
		#file {display:none}
		#toolbar ::selection,#toolbar::selection {color:none;background:0 0}
		.dropbtn {background-color:var(--btn-color);margin-top:10px;outline:0;color:var(--editor-text);padding:8px 16px 8px 16px;font-size:16px;margin-right:-5px;border:none}
		.dropdown {position:relative;display:inline-block}
		.dropdown:first-child {margin-left:10px}
		.dropdown-content {display:none;position:absolute;background-color:var(--btn-color);width:180px;box-shadow:0 2px 16px 0 rgba(0,0,0,.2);z-index:1}
		.dropdown-content * {color:var(--editor-text);padding:12px 16px;text-decoration:none;display:block}
		.dropdown-content p {padding:0 16px}
		.dropdown-content hr {margin:5px;padding:0;border-radius:50px;border-width:2px;border:1px solid gray}
		.dropdown-content a:hover {background-color:#777}
		.dropdown-content .disabled,.dropdown-content .work-in-progress {color:#777}
		.dropdown-content .disabled:hover,.dropdown-content .work-in-progress:hover {background-color:#555;cursor:not-allowed}
		.dropdown-content .disabled::after {content:" (Disabled)"}
		.dropdown-content .work-in-progress::after {content:" (Work-In-Progress"}
		.dropdown:hover .dropdown-content {display:block}
		.dropdown:hover .dropbtn {background-color:#777}
		* {transition:color .25s ease-in-out,background-color .25s ease-in-out,border-color .25s ease-in-out}
		a {cursor:pointer}
	</style>
</head>

<body>
	<noscript>Enable JavaScript</noscript>
	<form name="fileForm">
		<input type="file" id='file' name='file[]' accept=".HTML" />
	</form>
	<div id="toolbar">
		<div class="dropdown" id="filesMenu">
			<button class="dropbtn">File</button>
			<div class="dropdown-content">
				<a id="newSave">New</a>
				<a id="open">Open...</a>
				<a id="save">Save...</a>
				<hr>
				<a id="newNoSave">New without saving</a>
				<hr>
				<a id="nonHTMLBtn">Switch to Non-HTML editing</a>
			</div>
		</div>
		<div class="dropdown" id="viewMenu">
			<button class="dropbtn">View</button>
			<div class="dropdown-content">
				<a id="refresh">Refresh</a>
				<a id="setRefresh">Set Refresh time...</a>
				<a id="stopRefresh">Stop Dynamic Refresh</a>
				<a id="instantRefreshBtn">Enable Instant Refresh</a>
				<hr>
				<a id="eIframe">Open Iframe externally</a>
				<hr>
				<a id="indentSize">Set Tab Size...</a>
				<a id="fontSize">Set Font Size...</a>
				<a id="wrappingBtn">Enable wrapping</a>
				<hr>
				<a id="changeLightMode">Change light mode</a>
				<hr>
				<a id="forceReload">Force Reload Page</a>
			</div>
		</div>
		<div class="dropdown" id="otherMenu">
			<button class="dropbtn">Misc</button>
			<div class="dropdown-content">
				<a id="oldLoad">Load from old local storage</a>
				<a href="LHE-FAQ.html">FAQ</a>
				<hr>
				<a href="https://www.youtube.com/watch?v=onLsz9BwP7M" target="_blank">Original</a>
				<hr>
				<a id="settingsReset">Reset Settings</a>
			</div>
		</div>
		<div class="dropdown" id="fixesMenu">
			<button class="dropbtn">Fixes</button>
			<div class="dropdown-content">
				<a id="help1">"The editor doesn't refresh the preview!" (Reset Settings)</a>
			</div>
		</div>
		<div class="dropdown" id="helpMenu">
			<button class="dropbtn">Help</button>
			<div class="dropdown-content">
				<a href="https://www.w3schools.com/html/default.asp" target="_blank" id="html-tutorial">HTML Tutorial</a>
				<hr>
				<a href="https://htmlformatter.com/" target="_blank" id="prettify">Prettify HTML</a>
				<hr>
				<a href="https://htmlcodeeditor.com/" target="_parent">Alternative Live HTML Editor</a>
			</div>
		</div>
	</div>
	<form name='editor'>
		<div class="main" id="main">
			<!-- Grammarly disabled https://stackoverflow.com/a/46777787/13104233 -->
			<textarea id="editor-textarea" class="editor" autocomplete="off" autocapitalize="off" spellcheck="false" autofocus placeholder="HTML, CSS, and/or JS" data-gramm_editor="false">
<!DOCTYPE html>
<html>

<head>
	<title>Your Title Here</title>
	<meta name="viewport" content="width=device-width initial-scale=1">
	<link rel="stylesheet" type="text/css" href="path/to/stylesheet">
	<style>
		/* Styling */
	</style>
	<!-- Metadata and stuff -->
</head>

<body>
	<!-- Elements -->
</body>

<script>
	// Javascript
</script>

</html>
</textarea>
	</form>
	<iframe id="viewer">
		<p>Sorry, your browser doesn't support iframes. Try with another browser or just <a id="nonHTMLbtn">edit without a preview.</a></p>
	</iframe>
	</div>
</body>
<script>
var dSettings =  {
		'refreshInterval': 500,
		'autoRefresh': true,
		'instantRefresh': false,
		'tabSize': 4,
		'fontSize': 18,
		'disableWrapping': true,
		'lightMode': false
	},
	settings = dSettings,
	saved = false,
	fileName,
	wideLocalStorageName = "RTE_HTML",
	mainFunctions = [],
	windowExternalWindow,
	windowFeatures = "menubar=yes,location=no,resizable=yes,scrollbars=no,status=yes,fullscreen=yes";
load();
function settingsCheck()  {
	if (localStorage.settings == '' || localStorage.settings == null || localStorage.settings == undefined)  {
		localStorage.settings = JSON.stringify(dSettings);
		return dSettings;
	} else  {
		var TempSettings = localStorage.settings;
		settings = JSON.parse(TempSettings); // https://stackoverflow.com/a/2010948/13104233
		instantRefreshCheck();
		document.getElementById('editor-textarea').style.fontSize = settings.fontSize + "px";
		document.getElementById('editor-textarea').style.tabSize = settings.tabSize;
		checkWrapping();
		checkLightMode();
		return settings
	}
}

function settingsSave()  {
	localStorage.settings = JSON.stringify(settings);
	return settings;
}

function settingsReset()  {
	localStorage.removeItem("settings");
	localStorage.settings = JSON.stringify(dSettings);
	location.reload(true);
	return settings;
}

function settingsChange(setting, value)  {
	settings[setting] = value;
	settingsSave();
	console.log("Settings changed");
	return settings;
}

function toggleLightMode()  {
	if (settings.lightMode)  {
		document.body.setAttribute('theme', 'dark');
		document.getElementById('editor-textarea').setAttribute('theme', 'dark');
		document.getElementById('viewer').setAttribute('theme', 'dark');
		settingsChange('lightMode', false);
	} else if (settings.lightMode === false)  {
		document.body.setAttribute('theme', 'light');
		document.getElementById('editor-textarea').setAttribute('theme', 'light');
		document.getElementById('viewer').setAttribute('theme', 'light');
		settingsChange('lightMode', true);
	} else  {
		settingsChange('lightMode', false);
	}
	return settings.lightMode;
}

function checkLightMode()  {
	if (settings.lightMode)  {
		document.body.setAttribute('theme', 'light');
		document.getElementById('editor-textarea').setAttribute('theme', 'light');
		document.getElementById('viewer').setAttribute('theme', 'light');
	}
	return settings.lightMode;
}

function instantRefreshCheck()  {
	if (settings.instantRefresh)  {
		document.getElementById('instantRefreshBtn').innerHTML = "Disable Instant Refresh";
	}
	return settings.instantRefresh;
}
// https://www.abeautifulsite.net/adding-and-removing-elements-on-the-fly-using-javascript
function removeElement(elementId)  {
	// Removes an element from the document
	var element = document.getElementById(elementId);
	element.parentNode.removeChild(element);
	return element;
}

function nonHTMLMode()  {
	removeElement('viewer');
	document.getElementById('nonHTMLBtn').removeEventListener("click", nonHTMLMode);
	document.getElementById('nonHTMLBtn').addEventListener('click', reloading);
	document.getElementById('nonHTMLBtn').innerHTML = "Switch back to HTML Editor";
}

function refresh(time, downUp)  {
	saveLocal();
	if (settings.autoRefresh)  {
		if (settings.instantRefresh)  {
			refreshING();
			eRefreshING();
		} else  {
			mainFunctions.forEach(clearTimeout); // https://stackoverflow.com/questions/54277835/how-to-stop-calling-a-function-js/54277902#54277902
			mainFunctions = [];
			console.log("Detected " + downUp + " typing");
			mainFunctions.push(setTimeout(refreshING, time));
			mainFunctions.push(setTimeout(eRefreshING, time));
		}
	} else if (downUp == 'forced')  {
		refreshING();
		eRefreshING();
	}
	return;
}

function refreshING()  {
	saved = false;
	try  {
		// Adopted from CodeMirror HTML5 preview
		var previewFrame = document.getElementById('viewer');
		var preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
		preview.open();
		preview.write(document.getElementById('editor-textarea').value);
		preview.close();
		// Adopted from the original
		// document.getElementById('viewer').srcdoc = document.getElementById('editor-textarea').value;
	} catch (err)  {
		return err;
	}
	emptyAndLog("Refreshed");
	return true;
}

function eRefreshING()  {
	saved = false;
	try  {
		// Adopted from CodeMirror HTML5 preview
		var previewFrame = windowExternalWindow.document.getElementById('e-viewer');
		var preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
		preview.open();
		preview.write(document.getElementById('editor-textarea').value);
		preview.close();
		// Adopted from the original
		// windowExternalWindow.document.getElementById('e-viewer').srcdoc = document.getElementById('editor-textarea').value;
	} catch (err)  {
		return err;
	}
	emptyAndLog("Refreshed Externally");
	return true;
}

function toggleInstantRefresh()  {
	if (settings.instantRefresh)  {
		document.getElementById('instantRefreshBtn').innerHTML = "Enable Instant Refresh";
		settingsChange("instantRefresh", false);
	} else if (settings.instantRefresh === false)  {
		document.getElementById('instantRefreshBtn').innerHTML = "Disable Instant Refresh";
		if (settings.autoRefresh === false)  {
			stopRefresh();
		}
		settingsChange("instantRefresh", true);
		return settings.instantRefresh;
	}
}

function reloading()  {
	try  {
		windowExternalWindow.close();
		saveLocal();
		location.reload(true);
	} catch (err)  {
		saveLocal();
		location.reload(true);
	}
	return;
}

function stopRefresh()  {
	if (settings.autoRefresh)  {
		settingsChange("autoRefresh", false);
		document.getElementById('stopRefresh').innerHTML = "Start Dynamic Refresh";
		if (settings.instantRefresh)  {
			toggleInstantRefresh();
		}
	} else  {
		settingsChange("autoRefresh", true);
		document.getElementById('stopRefresh').innerHTML = "Stop Dynamic Refresh";
		refreshING();
	}
	return settings.autoRefresh;
}

function setRefreshTime()  {
	var timeOfRefresh = parseInt(prompt("How long until refresh? (MS)", settings.refreshInterval));
	if (typeof timeOfRefresh === null || timeOfRefresh == 'NaN' || typeof timeOfRefresh === NaN)  {
		return timeOfRefresh;
	}
	settingsChange("refreshInterval", timeOfRefresh);
	return settings.refreshInterval;
}

function checkWrapping()  {
	if (settings.disableWrapping == false)  {
		document.getElementById('editor-textarea').style.whiteSpace = "normal"; // Allow
		document.getElementById('wrappingBtn').innerHTML = "Disable Wrapping";
	}
	return settings.disableWrapping;
}

function wrapping()  {
	if (settings.disableWrapping == true)  {
		document.getElementById('editor-textarea').style.whiteSpace = "normal"; // Allow
		document.getElementById('wrappingBtn').innerHTML = "Disable Wrapping";
		settingsChange("disableWrapping", false);
	} else if (settings.disableWrapping == null || settings.disableWrapping == undefined || settings.disableWrapping == '' || settings.disableWrapping == false)  {
		document.getElementById('editor-textarea').style.whiteSpace = "nowrap"; // Disallow
		document.getElementById('wrappingBtn').innerHTML = "Enable Wrapping";
		settingsChange("disableWrapping", true);
	}
	return settings.disableWrapping;
}

function saveLocal(localStorageName = wideLocalStorageName)  {
	saved = false;
	localStorage.setItem(localStorageName, document.getElementById('editor-textarea').value);
	logAndEmpty("Saved");

	return localStorage.getItem(localStorageName);
}

function loadLocal()  {
	if (typeof localStorage.RTE_HTML == undefined || typeof localStorage.RTE_HTML == null || localStorage.RTE_HTML == '')  {
		return false;
	} else {
		document.getElementById('editor-textarea').value = localStorage.RTE_HTML;
		refreshING();
	}
	return localStorage.RTE_HTML;
}

function oldLoadLocal(oldLocalStorageName)  {
	if (localStorage.oldLocalStorageName == 'undefined' || localStorage.oldLocalStorageName == 'null' || localStorage.oldLocalStorageName == undefined || localStorage.oldLocalStorageName == null)  {
		console.log('Old local storage not found! ' + oldLocalStorageName);
		return false;
	} else  {
		document.getElementById('editor-textarea').value = localStorage.oldLocalStorageName;
		console.log("Loaded from old local storage! '" + localStorage.oldLocalStorageName + "'");
		localStorage.removeItem(oldLocalStorageName);
		console.log("Converted from old local storage! " + oldLocalStorageName);
		refreshING();
		return true;
	}
}

function allOfOldLoadLocal()  {
	oldLoadLocal("RTE_HTML_File");
	return;
}

// Open the file
// https://www.javascripture.com/FileReader
var openFile = function(event)  {
	fileName = document.getElementById('file').value.replace("C:\\fakepath\\", "");
	console.log(fileName);
	var input = event.target;
	resetText();
	var reader = new FileReader();
	reader.onload = function()  {
		var text = reader.result;
		var editor = document.getElementById('editor-textarea');
		editor.value = text;
		refreshING();
		saveLocal();
		fileForm.reset(); // https://www.geeksforgeeks.org/how-to-reset-a-form-using-jquery-with-reset-method/
	};
	reader.readAsText(input.files[0]);
};

function downloadHTML(fileNames = fileName)  {
	fileNames = prompt("Choose a name for your file", fileName);
	if (fileNames != 'null')  {
		fileNames.replace(".html", "");
		download(fileNames + ".html", document.getElementById('editor-textarea').value);
		saved = true
		return;
	}
}

function backupHTML()  {
	if (saved == false)  {
		download("backupHTML.html", document.getElementById('editor-textarea').value);
		saved = true;
	}
	return;
}

function download(filename, text)  { // https://stackoverflow.com/questions/3665115/how-to-create-a-file-in-memory-for-user-to-download-but-not-through-server
	var element = document.createElement('a');
	element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
	element.setAttribute('download', filename);
	element.style.display = 'none';
	document.body.appendChild(element);
	element.click();
	document.body.removeChild(element);
	saved = true;
}

function openExternalWindow()  {
	if (typeof windowExternalWindow === "undefined")  {
		childWindowChecking = setInterval(childWindowCheck, 1000);
		windowExternalWindow = window.open("", "External HTML Live View", windowFeatures);
		windowExternalWindow.document.write("<script>function confirmExit() {return \"\"}window.onbeforeunload=confirmExit;<\/script><body style=\"margin:0px;overflow:hidden;\"><iframe style=\"width: 100%;height:100%;border:0px;\" id=\"e-viewer\"></iframe></body>");
		removeElement("viewer");
		eRefreshING();
	}
}

function childWindowCheck()  { // Use not found, but is used on line 2 of openExternalWindow() function
	if (windowExternalWindow.closed) {
		saveLocal();
		reloading();
	}
}

function resetText()  {
	backupHTML();
	editor.reset();
	refreshING();
	saved = true;
	return;
}

function emptyAndLog(text)  {
	console.log('');
	console.log(text);
}

function logAndEmpty(text)  {
	console.log(text);
	console.log('');
}

function setIndentSize()  {
	var indentSize = parseInt(prompt("How many spaces for indenting?", settings.tabSize));
	document.getElementById('editor-textarea').style.tabSize = indentSize;
	settingsChange("tabSize", indentSize);
	return settings.tabSize;
}

function fontSize()  {
	var fontSizeChoice = parseInt(prompt("What would you like the font size to be?", settings.fontSize));
	if (fontSizeChoice != '' || fontSizeChoice != 'NaN' || fontSizeChoice !== null || fontSizeChoice !== undefined || fontSizeChoice != null)  {
		document.getElementById('editor-textarea').style.fontSize = fontSizeChoice + "px";
		settingsChange("fontSize", fontSizeChoice);
	}
	return settings.fontSize;
}

function insertAtCaret(areaId, text)  { // https://stackoverflow.com/questions/1064089/inserting-a-text-where-cursor-is-using-javascript-jquery
	var txtarea = document.getElementById(areaId);
	if (!txtarea)  {
		return;
	}
	var scrollPos = txtarea.scrollTop;
	var strPos = 0;
	var br = ((txtarea.selectionStart || txtarea.selectionStart == '0') ? "ff" : (document.selection ? "ie" : false));
	if (br == "ie")  {
		txtarea.focus();
		var range = document.selection.createRange();
		range.moveStart('character', -txtarea.value.length);
		strPos = range.text.length;
	} else if (br == "ff")  {
		strPos = txtarea.selectionStart;
	}
	var front = (txtarea.value).substring(0, strPos);
	var back = (txtarea.value).substring(strPos, txtarea.value.length);
	txtarea.value = front + text + back;
	strPos = strPos + text.length;
	if (br == "ie")  {
		txtarea.focus();
		var ieRange = document.selection.createRange();
		ieRange.moveStart('character', -txtarea.value.length);
		ieRange.moveStart('character', strPos);
		ieRange.moveEnd('character', 0);
		ieRange.select();
	} else if (br == "ff")  {
		txtarea.selectionStart = strPos;
		txtarea.selectionEnd = strPos;
		txtarea.focus();
	}
	txtarea.scrollTop = scrollPos;
}

function changeKeyPress(elementID, keyCode, text)  {
	document.getElementById(elementID).addEventListener("keydown", function(event)  {
		if (event.keyCode == keyCode)  {
			event.preventDefault();
			insertAtCaret(elementID, text);
		}
	});
}

function noMsgSaveLocal(localStorageName = wideLocalStorageName)  {
	localStorage.setItem(localStorageName, document.getElementById('editor-textarea').value);
	return localStorage.localStorageName;
}

function splitEditing()  {
	// get html, css, and js and then inject then display. oh, and also, change a variable that tells that it's in split edit mode which is also stored in local storage
}

function onStuff()  {
	document.body.addEventListener("beforeunload", reloading);
	document.getElementById('newSave').addEventListener("click", resetText);
	document.getElementById('open').addEventListener("click", function()  { document.getElementById('file').click() });
	document.getElementById('save').addEventListener("click", downloadHTML);
	document.getElementById('newNoSave').addEventListener("click", function()  { editor.reset(); refreshING(); });
	document.getElementById('nonHTMLBtn').addEventListener("click", nonHTMLMode);
	document.getElementById('refresh').addEventListener("click", function()  { refresh(0, 'forced'); });
	document.getElementById('setRefresh').addEventListener("click", setRefreshTime);
	document.getElementById('stopRefresh').addEventListener("click", stopRefresh);
	document.getElementById('instantRefreshBtn').addEventListener("click", toggleInstantRefresh);
	document.getElementById('eIframe').addEventListener("click", openExternalWindow);
	document.getElementById('indentSize').addEventListener("click", setIndentSize);
	document.getElementById('fontSize').addEventListener("click", fontSize);
	document.getElementById('wrappingBtn').addEventListener("click", wrapping);
	document.getElementById('changeLightMode').addEventListener("click", toggleLightMode);
	document.getElementById('forceReload').addEventListener("click", reloading);
	document.getElementById('oldLoad').addEventListener("click", allOfOldLoadLocal);
	document.getElementById('settingsReset').addEventListener("click", settingsReset);
	document.getElementById('help1').addEventListener("click", settingsReset);
	document.getElementById('editor-textarea').addEventListener("keyup", function()  { refresh(settings.refreshInterval, 'up') });
	document.getElementById('editor-textarea').addEventListener("keydown", function()  { refresh(settings.refreshInterval, 'down') });
	document.getElementById('file').addEventListener('change', function()  { openFile(event) } );
}

function load()  {
	var t0 = performance.now();
	console.clear();
	console.log("Ignore the fact it still uses document.write, it's to prevent flashing content");
	loadLocal();
	// https://www.html5rocks.com/en/tutorials/file/dndfiles/
	if (window.File && window.FileReader && window.FileList && window.Blob)  {} else  {alert('The File APIs are not fully supported in this browser. The file functions might not work correctly.');}
	settingsCheck();
	changeKeyPress('editor-textarea', 9, "\t");
	onStuff();
	setInterval(noMsgSaveLocal, 1000);
	setInterval(settingsSave, 1000);
	splitEditing();
	var t1 = performance.now();
	console.log("Took " + (t1 - t0) + "ms to load");
	alert("this page is no longer maintained and deprecated. no fixes will be given, and soon removed if not working anymore. you can find alternatives in the help menu.");
	return t1 - t0;
}
</script>
</html>